param M, integer, >= 1;
param N, integer, >= 1;
param P, integer, >= 1;

set I:={1..M};
set J:={1..N};

param d{j in J, i in I};

param file, symbolic, default "P-Medianas-Medium.txt";

var x{i in I, j in J} binary;
var y{i in I} binary;

minimize cost: sum{i in I, j in J}  d[j,i]*x[i,j];

s.t. demand{j in J}: sum{i in I} x[i,j] = 1;
s.t. aloc{i in I, j in J}: x[i,j] <= y[i];
s.t. knapsack: sum{i in I} y[i] = P;

solve;

printf '---------------------------------------------\n' >> file;
printf 'Cliente			Facilidade\n' >> file;
printf '---------------------------------------------\n' >> file;
printf {j in J, i in I: x[i,j] > 0.5} "%8d  %8d\n", j, i >> file;
printf '---------------------------------------------\n' >> file;
printf 'Custo total (z): ' >> file;
printf '%f \n', cost >> file;

data;

param M:=10;
param N:=25;
param P:=5;

param d :    1       2       3       4       5       6       7       8       9       10 :=
1	66.37   28.96   71.76   34.25   42.19   16.62   41.39   10.59   65.86   18.45
2	46.67   98.76    6.09   44.73   50.38   64.30   30.10   80.84   14.77   77.58
3	59.50   45.00   81.48   58.47   37.15   45.76   55.90   34.31   82.71   11.26
4	83.32   19.01   82.78   38.17   59.64   17.09   52.32   10.97   72.83   34.49
5	32.45   97.68    8.84   48.62   40.22   65.33   29.61   79.27   27.28   71.77
6	90.99    8.30   99.54   59.10   66.47   37.97   69.09   18.54   92.68   31.75
7	33.67   75.56   25.46   30.15   25.78   43.90    9.63   57.14   28.54   51.00
8	64.67   87.10   30.43   30.38   59.08   51.70   29.09   71.03   10.14   75.34
9	18.44   87.37   57.57   67.36   21.83   69.80   50.52   71.19   70.16   50.74
10	70.64   35.64   65.86   21.16   48.64    0.32   35.72   20.26   55.66   34.89
11	52.64   84.46   21.22   28.63   47.96   49.25   19.58   67.20    7.31   67.93
12	67.79   38.63   87.94   60.91   44.95   45.61   60.97   30.93   87.67   12.62
13	78.41   24.32   76.96   32.53   55.08   11.32   46.53   11.69   67.11   32.95
14	33.77   84.48   16.22   35.85   32.44   51.94   16.26   66.12   23.45   60.19
15	47.03   47.52   60.33   37.41   22.52   30.54   33.32   30.22   60.13   16.10
16	67.53   29.01   80.62   48.02   43.13   31.20   51.52   16.86   77.49    8.13
17	52.56  111.27   13.51   56.78   60.56   76.71   42.59   93.36   23.91   89.59
18	38.81   63.99   36.86   24.10   22.58   33.45    9.40   45.54   36.01   40.16
19	75.61   42.80   64.53   17.22   55.46   11.23   36.37   29.98   51.36   45.71
20	42.62   86.41   13.82   33.56   40.75   52.26   17.64   68.42   14.32   65.47
21	56.44   38.41   69.14   40.47   31.91   28.13   40.74   22.13   67.21    8.17
22	80.61   28.01   76.12   30.13   57.93   10.58   46.19   17.45   64.91   38.33
23	31.95   91.40   11.34   42.71   35.80   59.05   23.37   73.00   25.09   66.02
24	59.96   35.23   66.40   32.14   35.83   18.32   36.40   16.98   61.76   16.86
25	62.47   83.02   30.56   26.24   55.62   47.58   25.28   66.82   11.20   71.07;
end;